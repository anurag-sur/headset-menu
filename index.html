<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>VR Food Menu</title>

<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  overflow:hidden;
  font-family:'Inter',sans-serif;
  background:#0b0b0c;
  color:white;
}

/* ---------- UI Overlay ---------- */
#ui-overlay{
  position:absolute;
  inset:0;
  z-index:100;
  pointer-events:none;
}

#info{
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 18px;
  background:rgba(20,20,22,.85);
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  pointer-events:auto;
}

.btn{
  position:absolute;
  bottom:20px;
  padding:12px 18px;
  background:rgba(30,30,32,.9);
  border:1px solid rgba(255,255,255,.12);
  color:white;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition:background .15s, transform .1s;
  pointer-events:auto;
}
.btn:active{
  transform:scale(.96);
  background:rgba(50,50,55,.95);
}

#left{ left:16px; }
#right{ right:16px; }
#rate{
  left:50%;
  transform:translateX(-50%);
}

#ratingMenu{
  position:absolute;
  bottom:78px;
  left:50%;
  transform:translateX(-50%);
  padding:10px 16px;
  background:rgba(20,20,22,.92);
  border-radius:16px;
  display:none;
  pointer-events:auto;
}

.star{
  font-size:28px;
  cursor:pointer;
  color:rgba(255,255,255,.25);
  transition:color .15s, transform .1s;
}
.star.active{ color:#FFD54F; }
.star:active{ transform:scale(1.2); }

#toast{
  position:absolute;
  top:72px;
  left:50%;
  transform:translateX(-50%);
  background:#1f7aff;
  padding:8px 14px;
  border-radius:12px;
  font-size:14px;
  opacity:0;
  transition:opacity .3s;
}

#loading{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:#0b0b0c;
  z-index:10;
  font-size:18px;
  font-weight:600;
}

#loading-text{
  margin-bottom:12px;
}

#loading-progress{
  font-size:14px;
  color:rgba(255,255,255,.6);
}

#skip-loading{
  margin-top:20px;
  padding:10px 20px;
  background:#1f7aff;
  border:none;
  color:white;
  border-radius:10px;
  cursor:pointer;
  font-size:14px;
}

#vr-hint{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  font-size:14px;
  color:rgba(255,255,255,.7);
  pointer-events:auto;
}

#vr-hint button{
  margin-top:12px;
  padding:14px 28px;
  background:#1f7aff;
  border:none;
  color:white;
  border-radius:12px;
  font-size:18px;
  font-weight:600;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="ui-overlay">
  <div id="info"></div>
  <div id="toast"></div>
  <div id="loading">
    <div id="loading-text">Loading model…</div>
    <div id="loading-progress"></div>
    <button id="skip-loading">Skip & Use Placeholder</button>
  </div>
  
  <div id="vr-hint">
    <p>Put on your VR headset and tap below</p>
    <button id="enter-vr">Enter VR Mode</button>
  </div>

  <button id="left" class="btn">◀</button>
  <button id="rate" class="btn">Rate</button>
  <button id="right" class="btn">▶</button>

  <div id="ratingMenu">
    <span class="star" data-s="1">★</span>
    <span class="star" data-s="2">★</span>
    <span class="star" data-s="3">★</span>
    <span class="star" data-s="4">★</span>
    <span class="star" data-s="5">★</span>
  </div>
</div>

<a-scene id="scene" 
         vr-mode-ui="enabled:true"
         device-orientation-permission-ui="enabled:true">

  <!-- Environment -->
  <a-sky color="#0b0b0c"></a-sky>
  
  <!-- Lighting -->
  <a-entity light="type:ambient;intensity:0.8"></a-entity>
  <a-entity light="type:directional;intensity:0.5" position="2 3 1"></a-entity>
  <a-entity light="type:point;intensity:0.3" position="-2 2 -1"></a-entity>

  <!-- Camera -->
  <a-camera>
    <a-cursor
      color="#1f7aff"
      raycaster="objects: .clickable"
      fuse="true"
      fuse-timeout="1500">
    </a-cursor>
  </a-camera>

  <!-- Food Model Holder -->
  <a-entity id="holder" position="0 1.6 -2.5"></a-entity>

  <!-- UI Panel in VR -->
  <a-entity id="vr-ui" position="0 1.6 -3.5" visible="false">
    <!-- Info Text -->
    <a-text id="vr-info" 
            value="" 
            align="center" 
            width="3"
            position="0 0.8 0"
            color="#ffffff"></a-text>
    
    <!-- Navigation Buttons -->
    <a-box class="clickable nav-btn" 
           id="vr-left"
           position="-0.6 0.4 0" 
           width="0.3" 
           height="0.15" 
           depth="0.05"
           color="#1e1e20"
           material="opacity:0.9">
      <a-text value="◀ PREV" 
              align="center" 
              position="0 0 0.03" 
              width="1.5"
              color="#ffffff"></a-text>
    </a-box>

    <a-box class="clickable nav-btn" 
           id="vr-right"
           position="0.6 0.4 0" 
           width="0.3" 
           height="0.15" 
           depth="0.05"
           color="#1e1e20"
           material="opacity:0.9">
      <a-text value="NEXT ▶" 
              align="center" 
              position="0 0 0.03" 
              width="1.5"
              color="#ffffff"></a-text>
    </a-box>

    <!-- Rating Stars in VR -->
    <a-entity id="vr-stars" position="0 0.1 0">
      <a-text class="clickable vr-star" data-s="1" value="★" position="-0.4 0 0" width="2" color="#ffffff40"></a-text>
      <a-text class="clickable vr-star" data-s="2" value="★" position="-0.2 0 0" width="2" color="#ffffff40"></a-text>
      <a-text class="clickable vr-star" data-s="3" value="★" position="0 0 0" width="2" color="#ffffff40"></a-text>
      <a-text class="clickable vr-star" data-s="4" value="★" position="0.2 0 0" width="2" color="#ffffff40"></a-text>
      <a-text class="clickable vr-star" data-s="5" value="★" position="0.4 0 0" width="2" color="#ffffff40"></a-text>
    </a-entity>

    <!-- Rating Display -->
    <a-text id="rating-display" 
            value="Rating: 0/5" 
            align="center" 
            position="0 -0.15 0"
            width="2"
            color="#FFD54F"></a-text>
  </a-entity>

</a-scene>

<script>
const foods=[
 {model:"models/burger/scene.gltf",name:"Burger",price:"₹149",scale:.4,color:"#D2691E"},
 {model:"models/pizza/scene.gltf",name:"Pizza",price:"₹299",scale:2,color:"#FF6347"},
 {model:"models/fries/scene.gltf",name:"Fries",price:"₹99",scale:.5,color:"#FFD700"},
 {model:"models/assorted_salad/scene.gltf",name:"Assorted Salad",price:"₹129",scale:6,color:"#90EE90"},
 {model:"models/chole_bhature/scene.gltf",name:"Chole Bhature",price:"₹89",scale:6,color:"#DEB887"},
 {model:"models/grilled_sandwich/scene.gltf",name:"Grilled Sandwich",price:"₹49",scale:6,color:"#D2B48C"},
 {model:"models/palak_paneer/scene.gltf",name:"Palak Paneer",price:"₹79",scale:6,color:"#228B22"},
 {model:"models/potato_salad/scene.gltf",name:"Potato Salad",price:"₹89",scale:.01,color:"#F0E68C"},
 {model:"models/samosa/scene.gltf",name:"Samosa",price:"₹39",scale:.5,color:"#DAA520"},
 {model:"models/soup_bowl/scene.gltf",name:"Soup Bowl",price:"₹69",scale:.2,color:"#FF8C00"}
];

const holder=document.getElementById("holder");
const info=document.getElementById("info");
const vrInfo=document.getElementById("vr-info");
const loading=document.getElementById("loading");
const loadingText=document.getElementById("loading-text");
const loadingProgress=document.getElementById("loading-progress");
const toast=document.getElementById("toast");
const ratingMenu=document.getElementById("ratingMenu");
const vrUI=document.getElementById("vr-ui");
const vrHint=document.getElementById("vr-hint");
const scene=document.getElementById("scene");
const ratingDisplay=document.getElementById("rating-display");

let index=0, rating=0;
let scale=foods[0].scale;
let autoRotate=true;
let inVR=false;
let loadTimeout;
let currentModel;

/* ---------- Helpers ---------- */
function showToast(t){
 toast.textContent=t;
 toast.style.opacity=1;
 setTimeout(()=>toast.style.opacity=0,1200);
}

function updateStars(){
 // 2D UI stars
 document.querySelectorAll(".star").forEach(s=>{
  s.classList.toggle("active",s.dataset.s<=rating);
 });
 
 // VR stars
 document.querySelectorAll(".vr-star").forEach(s=>{
  const active = s.getAttribute("data-s")<=rating;
  s.setAttribute("color", active ? "#FFD54F" : "#ffffff40");
 });
 
 // Update rating display
 ratingDisplay.setAttribute("value", `Rating: ${rating}/5`);
}

/* ---------- Create Placeholder Shape ---------- */
function createPlaceholder(i){
 if(currentModel) {
  holder.removeChild(currentModel);
 }
 
 const food = foods[i];
 currentModel = document.createElement("a-entity");
 
 // Create a simple 3D shape based on food type
 let shape;
 if(food.name.includes("Burger") || food.name.includes("Sandwich")){
  shape = `<a-box color="${food.color}" width="0.5" height="0.3" depth="0.5"></a-box>`;
 } else if(food.name.includes("Pizza")){
  shape = `<a-cylinder color="${food.color}" radius="0.4" height="0.05"></a-cylinder>`;
 } else if(food.name.includes("Fries")){
  shape = `<a-box color="${food.color}" width="0.3" height="0.6" depth="0.3"></a-box>`;
 } else if(food.name.includes("Bowl") || food.name.includes("Soup")){
  shape = `<a-cylinder color="${food.color}" radius="0.3" height="0.25"></a-cylinder>`;
 } else if(food.name.includes("Samosa")){
  shape = `<a-cone color="${food.color}" radius-bottom="0.3" radius-top="0" height="0.4" rotation="90 0 0"></a-cone>`;
 } else {
  shape = `<a-sphere color="${food.color}" radius="0.3"></a-sphere>`;
 }
 
 currentModel.innerHTML = shape;
 currentModel.object3D.scale.set(scale, scale, scale);
 holder.appendChild(currentModel);
 
 loading.style.display="none";
 showToast("Using placeholder shape");
}

/* ---------- Load 3D Model ---------- */
function loadFood(i){
 loading.style.display="flex";
 loadingText.textContent = "Loading model…";
 loadingProgress.textContent = "Attempting to load 3D model";
 
 // Clear previous timeout
 if(loadTimeout) clearTimeout(loadTimeout);
 
 // Remove old model
 if(currentModel) {
  holder.removeChild(currentModel);
 }
 
 const food = foods[i];
 currentModel = document.createElement("a-entity");
 
 // Set timeout to use placeholder if model doesn't load
 loadTimeout = setTimeout(()=>{
  console.warn("Model loading timeout, using placeholder");
  loadingProgress.textContent = "Model not found, using placeholder";
  setTimeout(()=>createPlaceholder(i), 500);
 }, 5000); // 5 second timeout
 
 // Try to load the model
 currentModel.setAttribute("gltf-model", food.model);
 scale = food.scale;
 currentModel.object3D.scale.set(scale, scale, scale);
 
 const infoText = `${food.name} • ${food.price}`;
 info.textContent = infoText;
 vrInfo.setAttribute("value", infoText);
 
 rating = 0;
 updateStars();
 
 holder.appendChild(currentModel);
 
 // Model loaded successfully
 currentModel.addEventListener("model-loaded", ()=>{
  clearTimeout(loadTimeout);
  loading.style.display="none";
  console.log("Model loaded successfully");
 });
 
 // Model failed to load
 currentModel.addEventListener("model-error", (e)=>{
  clearTimeout(loadTimeout);
  console.error("Model load error:", e);
  loadingProgress.textContent = "Failed to load model, using placeholder";
  setTimeout(()=>createPlaceholder(i), 500);
 });
}

/* ---------- Skip Loading Button ---------- */
document.getElementById("skip-loading").onclick = ()=>{
 clearTimeout(loadTimeout);
 createPlaceholder(index);
};

// Start loading first food
loadFood(0);

/* ---------- 2D UI ---------- */
left.onclick=()=>{ 
 index=(index+foods.length-1)%foods.length; 
 loadFood(index); 
}

right.onclick=()=>{ 
 index=(index+1)%foods.length; 
 loadFood(index); 
}

rate.onclick=()=>{
 ratingMenu.style.display =
 ratingMenu.style.display==="block"?"none":"block";
};

document.querySelectorAll(".star").forEach(s=>{
 s.onclick=()=>{
  rating=s.dataset.s;
  updateStars();
  showToast(`Rated ${rating} ★`);
 };
});

/* ---------- VR UI ---------- */
document.getElementById("vr-left").addEventListener("click", ()=>{
 index=(index+foods.length-1)%foods.length; 
 loadFood(index);
});

document.getElementById("vr-right").addEventListener("click", ()=>{
 index=(index+1)%foods.length; 
 loadFood(index);
});

document.querySelectorAll(".vr-star").forEach(s=>{
 s.addEventListener("click", ()=>{
  rating=s.getAttribute("data-s");
  updateStars();
 });
});

/* ---------- VR Mode Detection ---------- */
scene.addEventListener("enter-vr", ()=>{
 inVR = true;
 vrUI.setAttribute("visible", "true");
 document.getElementById("ui-overlay").style.display = "none";
 autoRotate = true;
});

scene.addEventListener("exit-vr", ()=>{
 inVR = false;
 vrUI.setAttribute("visible", "false");
 document.getElementById("ui-overlay").style.display = "block";
});

/* ---------- Enter VR Button ---------- */
document.getElementById("enter-vr").onclick = ()=>{
 scene.enterVR();
};

/* ---------- Auto Rotate ---------- */
AFRAME.registerComponent("spin",{
 tick: function(time, timeDelta){
  if(autoRotate && currentModel){
   currentModel.object3D.rotation.y += 0.002;
  }
 }
});

// Add spin component to scene
const spinEntity = document.createElement("a-entity");
spinEntity.setAttribute("spin", "");
scene.appendChild(spinEntity);

/* ---------- Touch/Mouse Controls (2D mode) ---------- */
let dragging=false,lx=0,ly=0;

function start(x,y){
 if(inVR) return;
 dragging=true; lx=x; ly=y; autoRotate=false;
}

function move(x,y){
 if(inVR || !currentModel) return;
 const yaw = currentModel.object3D.rotation.y + (x-lx)*0.01;
 let pitch = currentModel.object3D.rotation.x + (y-ly)*0.01;
 pitch=Math.max(-1.4,Math.min(1.4,pitch));
 lx=x; ly=y;
 currentModel.object3D.rotation.set(pitch,yaw,0);
}

function end(){
 dragging=false;
 setTimeout(()=>autoRotate=true,2000);
}

document.addEventListener("touchstart",e=>{
 if(e.touches.length===1) start(e.touches[0].clientX,e.touches[0].clientY);
});
document.addEventListener("touchmove",e=>{
 if(dragging && e.touches.length===1)
  move(e.touches[0].clientX,e.touches[0].clientY);
});
document.addEventListener("touchend",end);

document.addEventListener("mousedown",e=>start(e.clientX,e.clientY));
document.addEventListener("mousemove",e=>dragging&&move(e.clientX,e.clientY));
document.addEventListener("mouseup",end);

document.addEventListener("wheel",e=>{
 if(inVR || !currentModel) return;
 scale+=e.deltaY*-0.001;
 scale=Math.max(.2,Math.min(2.5,scale));
 currentModel.object3D.scale.set(scale,scale,scale);
});
</script>

</body>
</html>
